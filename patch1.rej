***************
*** 1,850 ****
- diff --git a/patch1 b/patch1
- index 3f19479..e69de29 100644
- --- a/patch1
- +++ b/patch1
- @@ -1,695 +0,0 @@
- -diff --git a/patch1 b/patch1
- -index 5d9f3cc..e69de29 100644
- ---- a/patch1
- -+++ b/patch1
- -@@ -1,656 +0,0 @@
- --diff --git a/patch1 b/patch1
- --index 85fdadc..e69de29 100644
- ----- a/patch1
- --+++ b/patch1
- --@@ -1,651 +0,0 @@
- ---diff --git a/patch1 b/patch1
- ---index 9263cef..e69de29 100644
- ------ a/patch1
- ---+++ b/patch1
- ---@@ -1,325 +0,0 @@
- ----diff --git a/patch1 b/patch1
- ----index 7bbafce..e69de29 100644
- ------- a/patch1
- ----+++ b/patch1
- ----@@ -1,228 +0,0 @@
- -----diff --git a/sites/all/modules/product_catalog/product_catalog_ajax/product_catalog_ajax.module b/sites/all/modules/product_catalog/product_catalog_ajax/product_catalog_ajax.module
- -----index 1512d55..0f274c2 100755
- -------- a/sites/all/modules/product_catalog/product_catalog_ajax/product_catalog_ajax.module
- -----+++ b/sites/all/modules/product_catalog/product_catalog_ajax/product_catalog_ajax.module
- -----@@ -1045,19 +1045,47 @@ function product_catalog_ajax_select_submit() {
- -----         break;
- ----- 		
- -----       case 'available_product':
- ------  		$child->type = 'prdattributepackaged';
- ------  		$child->field_weight['und'][0]['value'] = $weight;
- ------  		$child->field_ref_product['und'][0]['nid'] = $tmpProductNid[1];
- ------  		$child->field_ref_connected_product['und'][0]['nid'] = $childNid;
- ------		
- ------  		// $term = taxonomy_term_load($tmpParentNid[1]);
- ------  		$term = taxonomy_get_term_by_name('Mandatory_MarketOpen','prdrelationtype');
- ------  		$child->field_ref_prdrelationtype['und'][0]['tid'] = current($term)->tid;
- ------  	
- ------  		node_save($child);
- ------  		$js_data['append_to'] = 'inside';
- ------  	  	break;
- -----+	  		$child->type = 'prdattributepackaged';
- -----+	  		$child->field_weight['und'][0]['value'] = $weight;
- -----+	  		$child->field_ref_product['und'][0]['nid'] = $tmpProductNid[1];
- -----+	  		$child->field_ref_connected_product['und'][0]['nid'] = $childNid;
- ----- 			
- -----+	  		// $term = taxonomy_term_load($tmpParentNid[1]);
- -----+	  		$term = taxonomy_get_term_by_name('Mandatory_MarketOpen','prdrelationtype');
- -----+	  		$child->field_ref_prdrelationtype['und'][0]['tid'] = current($term)->tid;
- -----+	  	
- -----+	  		node_save($child);
- -----+	  		$js_data['append_to'] = 'inside';
- -----+  	  	break;
- -----+  	  
- -----+  	  case 'discount_voucher_product_specific':
- -----+      	$voucharcardtype = node_load($tmpProductNid[1]);
- -----+
- -----+      	$child->type = 'treenodeproductfordisvoucher';
- -----+      	$child->field_weight['und'][0]['value'] = $weight;
- -----+      	$child->field_ref_vouchercardtype['und'][0]['nid'] = $tmpProductNid[1];
- -----+      	$child->field_ref_product['und'][0]['nid'] = $childNid;
- -----+      	node_save($child);
- -----+      	
- -----+      	// _create_treenodecounterforvoucherprd($child, $childNid);
- -----+      	
- -----+      	$js_data['append_to'] = 'inside';
- -----+      	
- -----+				$js_data['replace_or_append'] = 'replace';
- -----+				
- -----+				// delete existing .. 
- -----+				$view = views_get_view('list_treenodeproductforvoucher');
- -----+				$view->set_display('panel_pane_1');
- -----+				$view->set_arguments(array('0' => $tmpProductNid[1]));
- -----+				$view->execute();
- -----+				
- -----+				foreach($view->result as $record) {
- -----+					if($child->nid != $record->nid) {
- -----+						node_delete($record->nid);
- -----+					}
- -----+				}
- -----+      	break;
- -----+  	  
- -----       case 'voucher_product_specific':
- -----       	$voucharcardtype = node_load($tmpProductNid[1]);
- -----       	$voucherTypeTerm = taxonomy_term_load($voucharcardtype->field_ref_voucher_type['und'][0]['tid']);
- -----diff --git a/sites/all/modules/product_catalog/product_catalog_export/export_voucher_cardtype.inc b/sites/all/modules/product_catalog/product_catalog_export/export_voucher_cardtype.inc
- -----index 41c0dd6..87b06f0 100755
- -------- a/sites/all/modules/product_catalog/product_catalog_export/export_voucher_cardtype.inc
- -----+++ b/sites/all/modules/product_catalog/product_catalog_export/export_voucher_cardtype.inc
- -----@@ -36,22 +36,52 @@ function _array_voucher_cardtype($exportItemNids=NULL){
- ----- 				$validFor = $validStart . ' ~ '. $validEnd;
- ----- 				$jsonRecord['valid_for'] = $validFor;
- ----- 				
- ------        $listProduct = views_get_view_result('list_treenodeproductforvoucher', 'panel_pane_1', $record->nid);
- -----+				if($record->field_field_ref_voucher_type[0]['rendered']['#title'] == 'Discount') {
- ----- 				
- ------				$ret_product = array();
- ------				foreach($listProduct as $product) {
- ------		      $originalProductNode = node_load($product->node_field_data_field_ref_product_nid);
- ------		      
- ------		      if(!empty($originalProductNode)) {
- ------			      $tmpProduct['product_id'] = $originalProductNode->field_product_id['und'][0]['safe_value'];
- ------			      $tmpProduct['product_name'] = $product->node_title;
- ------						$tmpProduct['active_period'] = !empty($product->field_field_active_period)? $product->field_field_active_period[0]['raw']['value'] : null;
- ------						$tmpProduct['grace_period'] = !empty($product->field_field_grace_period)? $product->field_field_grace_period[0]['raw']['value'] : null;
- -----+					dsm($record, 'record');
- -----+					$jsonRecord['mapping_product'] = !empty($record->field_field_product_id) ? $record->field_field_product_id[0]['raw']['value']: null;
- -----+					
- -----+					$saleTypeArr = array();
- -----+					if(!empty($record->field_field_sale_type)) {
- -----+						foreach($record->field_field_sale_type as $saleType) {
- -----+							$saleTypeArr[] = $saleType['rendered']['#title'];
- -----+						}
- -----+						$jsonRecord['sale_type'] = $saleTypeArr;
- ----- 						
- ------						$ret_product[] = $tmpProduct;
- -----+					} else {
- -----+						$jsonRecord['sale_type'] = null;
- ----- 					}
- -----+					
- -----+					$listProduct = views_get_view_result('list_treenodeproductfordisvoucher', 'panel_pane_1', $record->nid);
- -----+					$ret_product = array();
- -----+					foreach($listProduct as $product) {
- -----+					  $originalProductNode = node_load($product->node_field_data_field_ref_product_nid);
- -----+					  
- -----+					  if(!empty($originalProductNode)) {
- -----+					    $tmpProduct['product_id'] = $originalProductNode->field_product_id['und'][0]['safe_value'];
- -----+					    $tmpProduct['product_name'] = $product->node_title;
- -----+							$ret_product[] = $tmpProduct;
- -----+						}
- -----+					}
- -----+				
- -----+				} else {
- -----+					$listProduct = views_get_view_result('list_treenodeproductforvoucher', 'panel_pane_1', $record->nid);
- -----+					$ret_product = array();
- -----+					foreach($listProduct as $product) {
- -----+			      $originalProductNode = node_load($product->node_field_data_field_ref_product_nid);
- -----+			      
- -----+			      if(!empty($originalProductNode)) {
- -----+				      $tmpProduct['product_id'] = $originalProductNode->field_product_id['und'][0]['safe_value'];
- -----+				      $tmpProduct['product_name'] = $product->node_title;
- -----+							$tmpProduct['active_period'] = !empty($product->field_field_active_period)? $product->field_field_active_period[0]['raw']['value'] : null;
- -----+							$tmpProduct['grace_period'] = !empty($product->field_field_grace_period)? $product->field_field_grace_period[0]['raw']['value'] : null;
- -----+							
- -----+							$ret_product[] = $tmpProduct;
- -----+						}
- -----+					}
- -----+					
- ----- 				}
- ------		
- -----+				
- ----- 				if(empty($ret_product)) {
- ----- 					$jsonRecord['products'] = null;
- ----- 		
- -----diff --git a/sites/all/modules/product_catalog/product_catalog_form/handler_validate.inc b/sites/all/modules/product_catalog/product_catalog_form/handler_validate.inc
- -----index d6c66a5..9b33750 100755
- -------- a/sites/all/modules/product_catalog/product_catalog_form/handler_validate.inc
- -----+++ b/sites/all/modules/product_catalog/product_catalog_form/handler_validate.inc
- -----@@ -419,7 +419,29 @@ function product_catalog_form_node_validate($node, $form, &$form_state) {
- -----                 drupal_set_message("Only Number is allowed for ID", 'error');
- -----                 form_set_error("Only Number is allowed for ID");
- -----             }
- ------
- -----+            
- -----+            $voucherCardTypeTerm = taxonomy_term_load($form_state['values']['field_ref_voucher_type']['und'][0]['tid']);
- -----+            
- -----+            dsm($voucherCardTypeTerm, 'voucherCardTypeTerm');
- -----+            
- -----+            if($voucherCardTypeTerm->name == 'Discount') {
- -----+            	dsm($form_state['values'], 'form state values');
- -----+            	if(empty($form_state['values']['field_ref_product_for_disvoucher']) 
- -----+            		|| empty($form_state['values']['field_ref_product_for_disvoucher']['und'])
- -----+            		|| empty($form_state['values']['field_ref_product_for_disvoucher']['und'][0])
- -----+            		|| empty($form_state['values']['field_ref_product_for_disvoucher']['und'][0]['nid'])            		
- -----+            	) {
- -----+								drupal_set_message("You should select the product mapped by the discount coupon", 'error');
- -----+								form_set_error("You should select the product mapped by the discount coupon");
- -----+            	} else {
- -----+            		if( count($form_state['values']['field_ref_product_for_disvoucher']['und']) > 1 ) {
- -----+	            		drupal_set_message("You should select only one mapping product", 'error');
- -----+	            		form_set_error("You should select only one mapping product");
- -----+            		}
- -----+            	}
- -----+            	
- -----+            }
- -----+            
- -----             break;
- ----- 
- -----         case 'simpleproductoffering_node_form' :
- -----diff --git a/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_context_menu_setting_Common.js b/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_context_menu_setting_Common.js
- -----index c647453..dac42f6 100644
- -------- a/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_context_menu_setting_Common.js
- -----+++ b/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_context_menu_setting_Common.js
- -----@@ -138,12 +138,23 @@
- ----- 							"voucher_product_specific" : {
- ----- 								"label" : "Select Product",
- ----- 								action : function(node) {
- ------									console.log('here');
- ----- 									$.fn.loadSelectForm(node);
- ----- 								}
- ----- 							},
- ----- 						};
- ----- 						break;
- -----+					case "discount_voucher_product_specific":
- -----+						menus.custom_create._disabled = false;
- -----+						menus.custom_create.submenu = {
- -----+							"discount_voucher_product_specific" : {
- -----+								"label" : "Select Product",
- -----+								action : function(node) {
- -----+									$.fn.loadSelectForm(node);
- -----+								}
- -----+							},
- -----+						};
- -----+						break;
- -----+					case "treenodeproductfordisvoucher":
- ----- 					case "treenodeproductforvoucher":
- ----- 						menus.custom_delete._disabled = false;
- ----- 						menus.custom_delete.action = function(node) {
- -----diff --git a/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_operation.js b/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_operation.js
- -----index 1f344c6..4cd7917 100644
- -------- a/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_operation.js
- -----+++ b/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_operation.js
- -----@@ -274,6 +274,7 @@
- -----             case 'treenodevouchercardforproduct':
- -----             case 'prdattributepackaged':
- -----             case "treenodeproductforvoucher":
- -----+            case "treenodeproductfordisvoucher":
- -----             case 'treenodeunittransferscheme':
- -----             case 'actionpricechargeonetime':
- -----             case 'actionpriceallowanceonetime':
- -----diff --git a/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_type_setting.js b/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_type_setting.js
- -----index 3c038c4..f8d0551 100755
- -------- a/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_type_setting.js
- -----+++ b/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_type_setting.js
- -----@@ -942,7 +942,13 @@
- ----- 					"icon" : {
- ----- 						"image" : "/sites/default/files/folder.png"
- ----- 					},
- ------				},
- -----+				},
- -----+				"discount_voucher_product_specific": {
- -----+					"valid_children" : ["treenodeproductfordisvoucher"],
- -----+					"icon" : {
- -----+						"image" : "/sites/default/files/folder.png"
- -----+					},
- -----+				},
- ----- 				"voucher_loyalty_point": {
- ----- 					"valid_children" : ["none"],
- ----- 					"icon" : {
- ----diff --git a/sites/all/modules/product_catalog/product_catalog_ajax/product_catalog_ajax.module b/sites/all/modules/product_catalog/product_catalog_ajax/product_catalog_ajax.module
- ----index 5eb0825..0f3a2f8 100755
- ------- a/sites/all/modules/product_catalog/product_catalog_ajax/product_catalog_ajax.module
- ----+++ b/sites/all/modules/product_catalog/product_catalog_ajax/product_catalog_ajax.module
- ----@@ -937,6 +937,8 @@ function product_catalog_ajax_select_submit() {
- ----   $min_weight = $_POST['min_weight'];
- ----   $rel_type = $_POST['rel_type'];
- ----   
- ----+  dsm($rel_type, 'rel_type');
- ----+  
- ----   $weightStep = -100;
- ----   $weight = $min_weight;
- ----   
- ----@@ -1111,7 +1113,7 @@ function product_catalog_ajax_select_submit() {
- ---- 	  		$child->field_ref_connected_product['und'][0]['nid'] = $childNid;
- ---- 			
- ---- 	  		// $term = taxonomy_term_load($tmpParentNid[1]);
- -----	  		$term = taxonomy_get_term_by_name('Mandatory_MarketOpen','prdrelationtype');
- ----+	  		$term = taxonomy_get_term_by_name('Bundled','prdrelationtype');
- ---- 	  		$child->field_ref_prdrelationtype['und'][0]['tid'] = current($term)->tid;
- ---- 	  	
- ---- 	  		node_save($child);
- ----diff --git a/sites/all/modules/product_catalog/product_catalog_form/handler_alter.inc b/sites/all/modules/product_catalog/product_catalog_form/handler_alter.inc
- ----index 296f11b..50dd17b 100755
- ------- a/sites/all/modules/product_catalog/product_catalog_form/handler_alter.inc
- ----+++ b/sites/all/modules/product_catalog/product_catalog_form/handler_alter.inc
- ----@@ -936,6 +936,7 @@ function product_catalog_form_form_alter(&$form, &$form_state, $form_id) {
- ---- 
- ---- 					if($productTypeName != 'Main') {
- ---- 
- ----+						/*
- ---- 						$args = array('0' => $svcDomainTid, 
- ---- 									'1' => $productTypeTid,
- ---- 									'2' => $billingTypeTid,
- ----@@ -953,9 +954,11 @@ function product_catalog_form_form_alter(&$form, &$form_state, $form_id) {
- ---- 						foreach($viewResult as $item) {
- ---- 							$options[$item->nid] = view_get_field_value_by_label($view, 'PHP', $item);
- ---- 						}
- -----							$form['field_next_join_product']['und']['#options'] = $options;
- -----						}
- -----          }
- ----+						$form['field_next_join_product']['und']['#options'] = $options;
- ----+						*/
- ----+						
- ----+					}
- ----+            }
- ---- 
- ----             $productTypeTid = $form['field_product_type']['und']['#default_value'][0];
- ---- 
- ----diff --git a/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_operation.js b/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_operation.js
- ----index 776a50b..c735a89 100644
- ------- a/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_operation.js
- ----+++ b/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_operation.js
- ----@@ -453,8 +453,8 @@
- ---- 		var data = event.data;		
- ---- 		
- ---- 		switch(data.type){
- -----		case 'select_numberingplan_domestic':			
- -----		case 'select_numberingplan_idd':			
- ----+		case 'select_numberingplan_domestic':
- ----+		case 'select_numberingplan_idd':
- ---- 		case 'select_timetable_domestic':
- ---- 		case 'select_timetable_idd':
- ---- 		case 'select_roamingplan':
- ----@@ -463,7 +463,7 @@
- ---- 		}
- ---- 		
- ---- 		if(isSelect){
- -----			var findStr = '\'.' + data.type + '_rows > div > input[name^=views_bulk_operations]:checked\'';			
- ----+			var findStr = '\'.' + data.type + '_rows > div > input[name^=views_bulk_operations]:checked\'';
- ---- 			var inputItems = $(findStr);
- ---- 			
- ---- 			if(inputItems.length == 0){
- ----@@ -476,16 +476,15 @@
- ---- 					selectedItemNid[i] = inputItems[i].value;
- ---- 				}
- ---- 				
- -----				var customSubmitUrl = '/product_catalog_ajax/custom_submit';				
- ----+				var customSubmitUrl = '/product_catalog_ajax/custom_submit';
- ---- 				$.ajax({
- ---- 					url : customSubmitUrl,
- ---- 					type: "post",
- ---- 			        data: {'type': data.type, 'tariffplanNid': data.tariffplanNid, 'refTreeTid': data.refTreeTid, 'selected_nid': selectedItemNid},
- ---- 					success : function(result) {
- -----						$.fn.reloadTreeContentDiv(data.node);			
- ----+						$.fn.reloadTreeContentDiv(data.node);
- ---- 					}
- ---- 				});
- -----				
- ---- 			}
- ---- 		}
- ---- 		
- ---diff --git a/sites/all/modules/ocs_admin/ocs_migrate.inc b/sites/all/modules/ocs_admin/ocs_migrate.inc
- ---index 8a20d5c..86e0760 100644
- ------ a/sites/all/modules/ocs_admin/ocs_migrate.inc
- ---+++ b/sites/all/modules/ocs_admin/ocs_migrate.inc
- ---@@ -303,16 +303,12 @@ function ocs_migrate_fce_carrier_submit($form, &$form_state)
- --- 		// add entities
- --- 		foreach ($form['#carrier'] as $r) {
- ---             $carrier_name = $r['ruleName'];
- ----			if ( isset( $carrier_info[$carrier_name])) {
- ---+			if ( isset( $carrier_info[$carrier_name]['nid'])) {
- --- 				dpm( t( 'existing carrier=@c prefix=@p', array( '@c' => $carrier_name, '@p' => $r['prefix'])));
- ----				if ( ! isset( $carrier_info[$carrier_name]['nid'])) {
- ----					dpm( t( 'carrier info not exist for "@c" prefix=@p', array( '@c' => $carrier_name, '@p' => $r['prefix'])));
- ----					continue;
- ----				}
- --- 				$node = node_load( $carrier_info[$carrier_name]['nid']);
- --- 			}
- --- 			else {
- ----				dpm( t( '>>> new carrier=@c prefix=@p', array( '@c' => $arrier_name, '@p' => $r['prefix'])));
- ---+				dpm( t( '>>> new carrier=@c prefix=@p', array( '@c' => $carrier_name, '@p' => $r['prefix'])));
- --- 				$node = ocs_admin_get_new_node('carrier_mobile');
- --- 			}
- --- 
- ---@@ -481,57 +477,86 @@ function ocs_migrate_fce_area_submit($form, &$form_state)
- --- function _update_area_code_for_domestic_voice( $carrier_info, $records, $check_only)
- --- {
- --- 	// add entities
- ---+	$codes = array();
- --- 	foreach ($records as $r) {
- ---+		$codes[$r['carrier']][$r['region_code']][] = $r;
- ---+	}
- --- 
- ----		if ( ! isset( $carrier_info[$r['carrier']])) {
- ----			dpm('Carrier not found: ' . $r['carrier']);
- ----			continue;
- ----		}
- ---+	foreach( $codes as $carrier => $regions) {
- ---+		foreach( $regions as $region_code => $records) {
- ---+			dpm( t('Carrier:@c  Region:@r', array( '@c' => $carrier, '@r' => $region_code)));
- --- 
- ----		if ( !isset( $carrier_info[$r['carrier']]['nid'])) {
- ----			dpm('Carrier nid not found: ' . $r['carrier']);
- ----			continue;
- ----		}
- ----		$carrier_nid = $carrier_info[$r['carrier']]['nid'];
- ----		
- ----		$query = new EntityFieldQuery();
- ----		$result = $query->entityCondition('entity_type', 'node')
- ----			->entityCondition('bundle', 'area_code')
- ----			->propertyCondition( 'title', $r['ruleName'])
- ----			->fieldCondition( 'field_ref_carrier_mobile', 'nid', $carrier_nid)
- ----			->fieldCondition( 'field_prefix', 'value', $r['second_prefix'])
- ----			->execute();
- ----
- ----		if ( count( $result) > 0) {
- ----			foreach( array_keys( $result['node']) as $nid) {
- ----				$node = node_load( $nid);
- ----				if ( $node->field_area_code['und'][0]['value'] != $r['region_code'] ) {
- ----					dpm( t('Area code is updated for @carrier prefix:@prefix. Region code: @a=>@b', 
- ----						array( '@carrier' => $r['carrier'], '@prefix' => $r['second_prefix'],
- ----							'@a' => $node->field_area_code['und'][0]['value'], '@b' => $r['region_code'])));
- ----						
- ----					$node->field_area_code['und'][0]['value'] = $r['region_code'];
- ---+			if ( $carrier == 'UNITEL_new') $carrier = 'UNITEL';
- ---+
- ---+			if ( ! isset( $carrier_info[$carrier])) {
- ---+				dpm('Carrier not found: ' . $carrier);
- ---+				continue;
- ---+			}
- ---+
- ---+			if ( !isset( $carrier_info[$carrier]['nid'])) {
- ---+				dpm('Carrier nid not found: ' . $carrier);
- ---+				continue;
- ---+			}
- ---+
- ---+			$carrier_nid = $carrier_info[$carrier]['nid'];
- ---+	
- ---+			$query = new EntityFieldQuery();
- ---+			$result = $query->entityCondition('entity_type', 'node')
- ---+				->entityCondition('bundle', 'area_code')
- ---+				->propertyCondition( 'title', $r['ruleName'])
- ---+				->fieldCondition( 'field_ref_carrier_mobile', 'nid', $carrier_nid)
- ---+				->fieldCondition( 'field_area_code', 'value', $region_code)
- ---+				->execute();
- ---+
- ---+			if ( count( $result) > 0) {
- ---+				$count = 0; 
- ---+				foreach( array_keys( $result['node']) as $nid) {
- ---+					$node = node_load( $nid);
- ---+
- ---+					if ( $count == 0) {
- ---+						unset( $node->field_prefix['und']);
- ---+
- ---+						$prefix = '';
- ---+						foreach( $records as $r) {
- ---+							$node->field_prefix['und'][] = array( 'value' => $r['second_prefix']);
- ---+							$prefix .= $r['second_prefix'] . ',';
- ---+						}
- ---+
- ---+						dpm( t('Area code is updated for @carrier prefix:@prefix. Region code: @r', 
- ---+							array( '@carrier' => $carrier, '@prefix' => $prefix, '@r' => $region_code)));
- ---+						if ( ! $check_only) node_save($node);
- ---+					}
- ---+					else {
- ---+						// remove all other area codes
- ---+						dpm( t('Remove Area code of @carrier prefix:@prefix. Region code: @a', 
- ---+							array( '@carrier' => $carrier, '@prefix' => $node->field_prefix['und'][0]['value'], '@a' => $region_code)));
- ---+					}
- ---+
- ---+					$count ++;
- --- 				}
- ----				else {
- ----					dpm( t('Existing Area code of @carrier prefix:@prefix. Region code: @a', 
- ----						array( '@carrier' => $r['carrier'], '@prefix' => $r['second_prefix'],
- ----							'@a' => $node->field_area_code['und'][0]['value'] )));
- ---+			}
- ---+			else {
- ---+				$node = ocs_admin_get_new_node('area_code');
- ---+				$node->title = $r['ruleName'];
- ---+				$node->field_area_code['und'][0]['value'] = $region_code;
- ---+				$node->field_ref_carrier_mobile['und'][0]['nid'] = $carrier_nid;
- ---+
- ---+				unset($node->field_prefix['und']);
- ---+				$prefix = '';
- ---+				foreach( $records as $r) {
- ---+					$node->field_prefix['und'][] = array( 'value' => $r['second_prefix']);
- ---+					$prefix .= $r['second_prefix'] . ',';
- --- 				}
- ---+
- ---+				$node->field_prefix['und'][0]['value'] = $r['second_prefix'];
- ---+
- ---+				dpm( t('Add New area code for @carrier prefix:@prefix. Region code: @b', 
- ---+					array( '@carrier' => $carrier, '@prefix' => $prefix, '@b' => $region_code)));
- ---+
- ---+				if ( ! $check_only) node_save($node);
- --- 			}
- ---+			
- --- 		}
- ----		else {
- ----			$node = ocs_admin_get_new_node('area_code');
- ----			$node->title = $r['ruleName'];
- ----			$node->field_prefix['und'][0]['value'] = $r['second_prefix'];
- ----			$node->field_area_code['und'][0]['value'] = $r['region_code'];
- ----			$node->field_ref_carrier_mobile['und'][0]['nid'] = $carrier_nid;
- ----
- ----			dpm( t('Add New area code for @carrier prefix:@prefix. Region code: @b', 
- ----				array( '@carrier' => $r['carrier'], '@prefix' => $r['second_prefix'],
- ----					'@b' => $r['region_code'])));
- ----		}
- ----		
- ----		if ( ! $check_only) node_save($node);
- --- 	}
- --- 
- --- }
- ---diff --git a/sites/all/modules/ocs_admin/ocs_migrate_numberingplan.inc b/sites/all/modules/ocs_admin/ocs_migrate_numberingplan.inc
- ---index acc794c..9f82adc 100644
- ------ a/sites/all/modules/ocs_admin/ocs_migrate_numberingplan.inc
- ---+++ b/sites/all/modules/ocs_admin/ocs_migrate_numberingplan.inc
- ---@@ -410,6 +410,7 @@ function _update_numberingplan_for_domestic_sms( $carrier_info, $target_nid, $ru
- ---         }
- --- 
- --- 		$carrier_name = $rule['called_carrier'];
- ---+		if ( $carrier_name == 'UNITEL_new') $carrier_name = 'UNITEL';	// same carrier
- --- 		$rating_group_name = $carrier_name . ':' . $rule['ruleName'];
- --- 
- ---         if ( ! isset( $carrier_info[$carrier_name]['nid'])) {
- ---diff --git a/sites/all/modules/product_catalog/product_catalog_export/export_product.inc b/sites/all/modules/product_catalog/product_catalog_export/export_product.inc
- ---index 41640bd..f621ccc 100755
- ------ a/sites/all/modules/product_catalog/product_catalog_export/export_product.inc
- ---+++ b/sites/all/modules/product_catalog/product_catalog_export/export_product.inc
- ---@@ -555,22 +555,24 @@ function _get_result($reqArray, $product) {
- --- 
- --- function _get_attribute_exceptions($product) {
- --- 
- ----    $retArray = array();
- ----
- ---+    $retArray = array();
- ---+    
- ---     $validStart = isset($product -> field_validfor_product['und'][0]['value']) ? $product -> field_validfor_product['und'][0]['value'] : '0001-01-01 00:00:00';
- --- 
- ---     $validEnd = isset($product -> field_validfor_product['und'][0]['value2']) ? $product -> field_validfor_product['und'][0]['value2'] : '0001-01-01 00:00:00';
- ----
- ----    if ($validStart == $validEnd) {
- ----        $validEnd = '9999-12-31 23:59:59';
- ---+    
- ---+    if ($validStart === $validEnd) {
- ---+    	dsm('here');
- ---+    	$validEnd = '9999-12-31 23:59:59';
- ---     } else {
- ----        if (!empty($record -> field_validfor_product)) {
- ----            $tempArr = explode(' ', $record -> field_validfor_product['und'][0]['value2']);
- ---+        if (!empty($product -> field_validfor_product)) {
- ---+            $tempArr = explode(' ', $product -> field_validfor_product['und'][0]['value2']);
- ---             $validEnd = $tempArr[0] . ' 23:59:59';
- ---         } else {
- ---             $validEnd = '9999-12-31 23:59:59';
- ---         }
- ---     }
- ---+    
- ---     $validForStr = $validStart . ' ~ ' . $validEnd;
- --- 
- ---     $retArray['valid_for'] = $validForStr;
- ---diff --git a/sites/all/modules/product_catalog/product_catalog_form/handler_alter.inc b/sites/all/modules/product_catalog/product_catalog_form/handler_alter.inc
- ---index 1cae992..fb1ea47 100755
- ------ a/sites/all/modules/product_catalog/product_catalog_form/handler_alter.inc
- ---+++ b/sites/all/modules/product_catalog/product_catalog_form/handler_alter.inc
- ---@@ -854,6 +854,8 @@ function product_catalog_form_form_alter(&$form, &$form_state, $form_id) {
- ---             $form['field_ref_target_product']['und']['#options'] = $options['list'];
- ---             break;
- ---         case 'simpleproductoffering_node_form' :
- ---+        	dsm($form, 'form');
- ---+        	dsm($form_state, 'form-state');
- ---         		
- ---         		$disabledItems = array();
- --- 						$hiddenItems = array();
- ---@@ -907,15 +909,28 @@ function product_catalog_form_form_alter(&$form, &$form_state, $form_id) {
- --- 	                }
- ---                 }
- ---                 
- ---+                //calltype
- ---+                $options = _get_call_type_options();
- ---+                $form['field_ref_type_of_call_mul']['und']['#options'] = $options;
- ---+                 
- ---+                $form['field_ref_thres_counter_acc']['#prefix'] = '<div id="deposit_counter_set">';
- ---+                $form['field_ref_thresholdscheme']['#prefix'] = '</div>';
- ---+                
- ---+                $form['field_counter_unit_type']['und']['#ajax'] = array(
- ---+                    'callback' => 'deposit_counter_callback',
- ---+                    'wrapper' => 'deposit_counter_set',
- ---+                );
- ---                 
- ---             // in case Edit
- ---             } else {
- ---             		$hiddenItems = array_merge($hiddenItems, array('field_product_type',
- ---             													'field_service_type_of_provider'));
- ---             													
- ----            		$disabledItems = array_merge($disabledItems, array( //'field_billing_type',
- ---+            		$disabledItems = array_merge($disabledItems, array( 'field_billing_type',
- ---             														'field_price_units',
- ----            														'field_product_id'));
- ---+            														'field_product_id',
- ---+            														'field_customer_type',
- ---+            														'field_customer_group_type'));
- ---              		
- ---              		$productTypeTid = $form['field_product_type']['und']['#default_value'][0];
- ---              		$productTypeName = $form['field_product_type']['und']['#options'][$productTypeTid];
- ---@@ -924,8 +939,8 @@ function product_catalog_form_form_alter(&$form, &$form_state, $form_id) {
- ---              			$hiddenItems[] = 'field_cug_member_counter';
- ---              			$unsetItems[] = 'field_cug_group_type';
- ---              			$unsetItems[] = 'field_cug_customer_type';
- ----	              	unset($form['#groups']['group_cug']);
- ----									unset($form['#fieldgroups']['group_cug']);
- ---+	              		unset($form['#groups']['group_cug']);
- ---+						unset($form['#fieldgroups']['group_cug']);
- ---              		} else {
- ---              			$disabledItems[] = 'field_cug_customer_type';
- ---              			$disabledItems[] = 'field_cug_group_type';
- ---@@ -1809,8 +1824,8 @@ function product_catalog_form_form_alter(&$form, &$form_state, $form_id) {
- ---             $form['field_ref_source_action']['#type'] = 'hidden';
- ---             $productNid = $form_state['product_nid'];
- --- 
- ----						$basicCounterList = array();
- ----						$existingCounterList = array();
- ---+			$basicCounterList = array();
- ---+			$existingCounterList = array();
- --- 						
- ---             $product = node_load($productNid);
- ---             
- ---@@ -1839,8 +1854,11 @@ function product_catalog_form_form_alter(&$form, &$form_state, $form_id) {
- ---         case 'actionsetcounteronbonus_node_form' :
- ---         	
- ---             $form['field_ref_source_action']['#type'] = 'hidden';
- ----            $productNid = $form_state['product_nid'];
- ----
- ---+            $productNid = $form_state['product_nid'];
- ---+            
- ---+            $basicCounterList = array();
- ---+            $existingCounterList = array();
- ---+            
- ---             $product = node_load($productNid);
- ---             $billingTypeTerm = taxonomy_term_load($product -> field_billing_type['und'][0]['tid']);
- ---             if ($billingTypeTerm -> name == 'Postpaid') {
- ---@@ -1848,11 +1866,8 @@ function product_catalog_form_form_alter(&$form, &$form_state, $form_id) {
- ---                 $existingCounterList = _get_existing_counter_list($productNid,  current($tempTerm) -> tid);
- --- 
- ---             } else {
- ----                $basicCounterList = array();
- ---                 $basicCounterList = _get_default_basic_counters($productNid);
- ----                
- ----                $existingCounterList = _get_existing_counter_list($productNid);
- ----
- ---+               	$existingCounterList = _get_existing_counter_list($productNid);
- ---             }
- ---             
- ---             $mergedCounterList = $basicCounterList + $existingCounterList;
- ---diff --git a/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_context_sub_menu.js b/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_context_sub_menu.js
- ---index 5c37365..16f1ab8 100644
- ------ a/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_context_sub_menu.js
- ---+++ b/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_context_sub_menu.js
- ---@@ -219,6 +219,7 @@
- --- 			case 'conditionwhatcontentprice':
- --- 			case 'conditionwhatcalltype':
- --- 			case 'conditionwhenvaliddate':
- ---+			case 'treenodeotheronetimechargediscou':
- --- 				menus.custom_delete._disabled = false;
- --- 				menus.custom_delete.action = function(node) {
- --- 					$.fn.deleteNode(node);
- ---diff --git a/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_type_setting.js b/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_type_setting.js
- ---index 06e0673..faefb34 100755
- ------ a/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_type_setting.js
- ---+++ b/sites/all/modules/product_catalog/product_catalog_tree/js/product_catalog_tree_type_setting.js
- ---@@ -396,7 +396,8 @@
- ---         	        }
- ---         },
- ---         "actionpricechargerecurring" : {
- ----		        "valid_children" : ["conditioncommonand_nonusage_recurring"],
- ---+		        "valid_children" : [ "conditioncommonand",
- ---+		                             "conditioncommonand_nonusage_recurring"],
- ---     		    	"icon" : {
- ---         		"image" : "/sites/default/files/icons/money.png"
- ---             }
- -diff --git a/sites/all/modules/product_catalog/product_catalog_export/export_product.inc b/sites/all/modules/product_catalog/product_catalog_export/export_product.inc
- -index f621ccc..f501ea6 100755
- ---- a/sites/all/modules/product_catalog/product_catalog_export/export_product.inc
- -+++ b/sites/all/modules/product_catalog/product_catalog_export/export_product.inc
- -@@ -562,12 +562,12 @@ function _get_attribute_exceptions($product) {
- -     $validEnd = isset($product -> field_validfor_product['und'][0]['value2']) ? $product -> field_validfor_product['und'][0]['value2'] : '0001-01-01 00:00:00';
- -     
- -     if ($validStart === $validEnd) {
- --    	dsm('here');
- -     	$validEnd = '9999-12-31 23:59:59';
- -     } else {
- -         if (!empty($product -> field_validfor_product)) {
- -             $tempArr = explode(' ', $product -> field_validfor_product['und'][0]['value2']);
- --            $validEnd = $tempArr[0] . ' 23:59:59';
- -+            // $validEnd = $tempArr[0] . ' 23:59:59';
- -+            $validEnd = $tempArr[0] . ' ' . $tempArr[1];
- -         } else {
- -             $validEnd = '9999-12-31 23:59:59';
- -         }
- -diff --git a/sites/all/modules/product_catalog/product_catalog_services/pc_code/pc_code.module b/sites/all/modules/product_catalog/product_catalog_services/pc_code/pc_code.module
- -index cdeecb5..aef77e5 100755
- ---- a/sites/all/modules/product_catalog/product_catalog_services/pc_code/pc_code.module
- -+++ b/sites/all/modules/product_catalog/product_catalog_services/pc_code/pc_code.module
- -@@ -17,8 +17,8 @@ function pc_code_menu() {
- - 
- - function pc_code_update_in_views($code_group) {
- - 
- --    $url = 'http://202.70.46.180:8001/openapi/code/' . $code_group;
- --    // $url = 'http://10.21.8.20:8001/openapi/code/' . $code_group;
- -+    // $url = 'http://202.70.46.180:8001/openapi/code/' . $code_group;
- -+    $url = 'http://10.21.8.20:8001/openapi/code/' . $code_group;
- -     $result = drupal_http_request($url);
- -     dsm($result,'result');
- -     $codes_list = json_decode($result -> data);
- diff --git a/sites/all/modules/product_catalog/product_catalog_form/handler_alter.inc b/sites/all/modules/product_catalog/product_catalog_form/handler_alter.inc
- index 7f594cf..22b2ad5 100755
- --- a/sites/all/modules/product_catalog/product_catalog_form/handler_alter.inc
- +++ b/sites/all/modules/product_catalog/product_catalog_form/handler_alter.inc
- @@ -241,7 +241,7 @@ function edit_pane_callback($form, &$form_state) {
-  
-  function product_catalog_form_form_alter(&$form, &$form_state, $form_id) {
-  
- -	//dsm($form_id);
- +	// dsm($form_id);
-  	load_required_js_css_before_ajax_load();
-  
-      if ((isset($form['#attributes']) && isset($form['#attributes']['class'])) && gettype($form['#attributes']['class']) == 'array') {
- @@ -249,6 +249,9 @@ function product_catalog_form_form_alter(&$form, &$form_state, $form_id) {
-      }
-      
-      switch($form_id) {
- +    		case 'views_form_ocs_svc_perm_panel_pane_4':
- +    			unset($form['actions']);
- +    			break;
-      		case 'views_form_ocs_svc_perm_panel_pane_1':
-  				//dpm( $form, 'form ');
-  
- @@ -872,15 +875,15 @@ function product_catalog_form_form_alter(&$form, &$form_state, $form_id) {
-  									'field_version',
-  									'field_is_bundle',
-  									'field_roaming_allowed',
- -											'field_offering_status',
- -											'field_parent_node_for_rp',
- -											'field_weight_for_ratingpriority',
- -											'field_weight',
- -										'field_ref_product',
- -											'field_parent_node',
- -											'field_tpl_voca_machine_name',
- -											'field_parent_node_for_hr',
- -											'field_weight_for_hierarchy');
- +									'field_offering_status',
- +									'field_parent_node_for_rp',
- +									'field_weight_for_ratingpriority',
- +									'field_weight',
- +									'field_ref_product',
- +									'field_parent_node',
- +									'field_tpl_voca_machine_name',
- +									'field_parent_node_for_hr',
- +									'field_weight_for_hierarchy');
-  		  // in case Create
-              if (!isset($form['nid']['#value'])) {
-              
- @@ -1346,8 +1349,7 @@ function product_catalog_form_form_alter(&$form, &$form_state, $form_id) {
-                $depositSchemeNode = node_load($form_state['build_info']['args'][0] -> field_ref_depositscheme['und'][0]['nid']);
-                $serviceDomainTid = $depositSchemeNode -> field_service_domain['und'][0]['tid'];
-                $form['field_thismonth_accu_counter']['#type'] = 'hidden';
- -              
- -              /*
- +
-  			  $options = array();
-  			  $options['_none'] = '- None -';
-  							              
- @@ -1366,8 +1368,8 @@ function product_catalog_form_form_alter(&$form, &$form_state, $form_id) {
-  	            }
-  	            
-                $form['field_ref_thres_counter_acc']['und']['#options'] = $options;
- -              $form['field_ref_thres_counter_limit']['und']['#options'] = $options;
- -              */ 
- +              $form['field_ref_thres_counter_limit']['und']['#options'] = $options;
- +              
-              } else {// edit
-                $depositSchemeNode = node_load($depositSchemeFactorNode->field_ref_depositscheme['und'][0]['nid']);
-                $serviceDomainTid = $depositSchemeNode->field_service_domain['und'][0]['tid'];
- @@ -1401,8 +1403,7 @@ function product_catalog_form_form_alter(&$form, &$form_state, $form_id) {
-                        $counterUnitType = $form_state['build_info']['args'][0]->field_counter_unit_type['und'][0]['tid'];
-                    }
-                }
- -              
- -              /*
- +              
-                $view = views_get_view('list_counter');
-                $view -> set_display('panel_pane_10');
-                $view -> set_arguments(array('0' => $serviceDomainTid,
- @@ -1418,29 +1419,13 @@ function product_catalog_form_form_alter(&$form, &$form_state, $form_id) {
-                
-                $form['field_ref_thres_counter_acc']['und']['#options'] = $options;
-                $form['field_ref_thres_counter_limit']['und']['#options'] = $options;
- -              */
- -              
-                
-              }
-              
-              //calltype
-              $options = _get_call_type_options();
-              $form['field_ref_type_of_call_mul']['und']['#options'] = $options;
- -            
- -            $options = array();
- -                                      
- -            $view = views_get_view('list_counter');
- -            $view -> set_display('panel_pane_10');
- -            $view -> set_arguments(array('0' => $serviceDomainTid));
- -            $view -> execute();
- -              
- -            foreach ($view->result as $item) {
- -              $options[$item->nid] = view_get_field_value_by_label($view, 'PHP', $item);
- -            }
- -             
- -            $form['field_ref_thres_counter_acc']['und']['#options'] = $options;
- -            $form['field_ref_thres_counter_limit']['und']['#options'] = $options;
- -            /*
- +             
-              $form['field_ref_thres_counter_acc']['#prefix'] = '<div id="deposit_counter_set">';
-              $form['field_ref_thresholdscheme']['#prefix'] = '</div>';
-              
- @@ -1448,11 +1433,7 @@ function product_catalog_form_form_alter(&$form, &$form_state, $form_id) {
-                  'callback' => 'deposit_counter_callback',
-                  'wrapper' => 'deposit_counter_set',
-              );
- -            */
- -            //dsm($form_state,'form state');
- -            //$form['field_ref_thres_counter_acc']['und']['#validated'] = TRUE;
- -            //$form['field_ref_thres_counter_limit']['und']['#validated'] = TRUE;
- -            //dsm($form,'form');
- +            
-              break;
-              
-          case 'depositschemeadjustment_node_form' :
- @@ -2311,7 +2292,7 @@ function actionsetcounter_ajax_callback($form, &$form_state){
-      return $returnStr;
-  }
-  
- -function deposit_counter_callback($form,&$form_state) {
- +function deposit_counter_callback($form,$form_state) {
-  
-    $depositSchemeNode = node_load($form_state['build_info']['args'][0] -> field_ref_depositscheme['und'][0]['nid']);
-    $serviceDomainTid = $depositSchemeNode -> field_service_domain['und'][0]['tid'];
- @@ -2332,15 +2313,13 @@ function deposit_counter_callback($form,&$form_state) {
-  	}
-  	$form['field_ref_thres_counter_acc']['und']['#options'] = $options;
-  	$form['field_ref_thres_counter_limit']['und']['#options'] = $options;
- -	
- -              
- +	
-  //	$renderStr = '<div id="deposit_counter_set">';
-  	$renderStr .= drupal_render($form['field_ref_thres_counter_acc']);
-  	$renderStr .= drupal_render($form['field_ref_thres_counter_limit']);
-  //	$renderStr .= '</div>';
-  
- -	//$form_state['rebuild'] = TRUE;
- -	//$form_state['counter_filtered'] = TRUE;
- +	$form_state['rebuild'] = TRUE;
-  	
-  	return $renderStr;
-  }
--- 0 ----
